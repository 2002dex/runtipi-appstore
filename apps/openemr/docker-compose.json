{
  "schemaVersion": 2,
  "services": [
    {
      "name": "mysql",
      "image": "mariadb:10.5",
      "environment": [
        { 
          "key": "MYSQL_ROOT_PASSWORD", 
          "value": "${MYSQL_ROOT_PASSWORD:-root}" 
        },
        { 
          "key": "MYSQL_DATABASE", 
          "value": "openemr" 
        },
        { 
          "key": "MYSQL_USER", 
          "value": "${MYSQL_USER:-openemr}" 
        },
        { 
          "key": "MYSQL_PASSWORD", 
          "value": "${MYSQL_PASS:-openemr}" 
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/mysql",
          "containerPath": "/var/lib/mysql",
          "readOnly": false
        }
      ],
      "isMain": false
    },
    {
      "name": "openemr",
      "image": "openemr/openemr:7.0.3",
      "isMain": true,
      "internalPort": 80,
      "addToMainNetwork": true,
      "addPorts": [
        {
          "containerPort": 80,
          "hostPort": "${APP_PORT:-8084}",
          "tcp": true
        },
        {
          "containerPort": 443,
          "hostPort": 8443,
          "tcp": true
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/sites",
          "containerPath": "/var/www/localhost/htdocs/openemr/sites",
          "readOnly": false
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/log",
          "containerPath": "/var/log",
          "readOnly": false
        }
      ],
      "environment": [
        { 
          "key": "MYSQL_HOST", 
          "value": "mysql" 
        },
        { 
          "key": "MYSQL_ROOT_PASS", 
          "value": "${MYSQL_ROOT_PASSWORD:-root}" 
        },
        { 
          "key": "MYSQL_USER", 
          "value": "${MYSQL_USER:-openemr}" 
        },
        { 
          "key": "MYSQL_PASS", 
          "value": "${MYSQL_PASS:-openemr}" 
        },
        { 
          "key": "OE_USER", 
          "value": "${OE_USER:-admin}" 
        },
        { 
          "key": "OE_PASS", 
          "value": "${OE_PASS:-pass}" 
        }
      ],
      "dependsOn": ["mysql"]
    }
  ]
}